
**Base URL:** `https://d5dvnkk82lmmsbbr7ob1.4b4k4pg5.apigw.yandexcloud.net`

### POST /register

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ.

**Request:**
```json
{
  "email": "user@example.com",
  "password": "password123",
  "name": "–ò–º—è –§–∞–º–∏–ª–∏—è",
  "birthDate": "1990-01-01",
  "gender": "male"
}
```

**Response (–Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):**
```json
{
  "token": "eyJhbGci...",
  "user": {
    "email": "user@example.com",
    "name": "–ò–º—è –§–∞–º–∏–ª–∏—è",
    "birthDate": "1990-01-01",
    "gender": "male",
    "registrationDate": "2025-10-11T16:32:33.150Z",
    "tariff_info": {
      "status": "TRIAL",
      "trialCount": 4
    }
  }
}
```

**Response (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):**
```json
{
  "token": "eyJhbGci..."
}
```

### POST /login

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Request:**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**Response:**
```json
{
  "token": "eyJhbGci..."
}
```

**Error (404):**
```json
{
  "error": "User not found"
}
```

**Error (401):**
```json
{
  "error": "Invalid password"
}
```

### GET /user/me

–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Headers:**
```
Authorization: Bearer eyJhbGci...
```

**Response:**
```json
{
  "user": {
    "email": "user@example.com",
    "name": "–ò–º—è –§–∞–º–∏–ª–∏—è",
    "birthDate": "1990-01-01",
    "gender": "male",
    "registrationDate": "2025-10-11T16:32:33.150Z",
    "tariff_info": {
      "status": "TRIAL",
      "trialCount": 2
    }
  }
}
```

### POST /subscription/activate

–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ PRO –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.

**Headers:**
```
Authorization: Bearer eyJhbGci...
```

**Request:**
```json
{
  "duration": "1month",
  "paymentId": "yukassa_payment_123"
}
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è duration:**
- `"1month"` - 1 –º–µ—Å—è—Ü
- `"3months"` - 3 –º–µ—Å—è—Ü–∞
- `"1year"` - 1 –≥–æ–¥

**Response:**
```json
{
  "success": true,
  "tariff_info": {
    "status": "PRO",
    "start": "2025-10-11T16:32:33.150Z",
    "end": "2025-11-11T16:32:33.150Z"
  },
  "transaction": {
    "id": "57bcdcc2-c502-468e-8f39-54120b9e8704",
    "userId": "user@example.com",
    "duration": "1month",
    "description": "–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ PRO –Ω–∞ 1 –º–µ—Å—è—Ü(–µ–≤)",
    "createdAt": "2025-10-11T16:19:12.032Z",
    "paymentId": "yukassa_payment_123"
  }
}
```

### POST /subscription/check-access

–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ PRO —Ñ—É–Ω–∫—Ü–∏—è–º. –ï—Å–ª–∏ –µ—Å—Ç—å TRIAL –ø–æ–ø—ã—Ç–∫–∏ –∏–ª–∏ –∞–∫—Ç–∏–≤–Ω–∞—è PRO –ø–æ–¥–ø–∏—Å–∫–∞ - —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∏ —É–º–µ–Ω—å—à–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ TRIAL.

**Headers:**
```
Authorization: Bearer eyJhbGci...
```

**Response (—É—Å–ø–µ—à–Ω—ã–π –¥–æ—Å—Ç—É–ø - PRO):**
```json
{
  "hasAccess": true,
  "tariff_info": {
    "status": "PRO",
    "start": "2025-10-11T16:32:33.150Z",
    "end": "2025-11-11T16:32:33.150Z"
  }
}
```

**Response (—É—Å–ø–µ—à–Ω—ã–π –¥–æ—Å—Ç—É–ø - TRIAL):**
```json
{
  "hasAccess": true,
  "tariff_info": {
    "status": "TRIAL",
    "trialCount": 3
  },
  "remainingTrials": 3
}
```

**Response (–æ—Ç–∫–∞–∑ - TRIAL –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å):**
```json
{
  "hasAccess": false,
  "reason": "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å. –ü—Ä–∏–æ–±—Ä–µ—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É PRO"
}
```

**Response (–æ—Ç–∫–∞–∑ - –ø–æ–¥–ø–∏—Å–∫–∞ PRO –∏—Å—Ç–µ–∫–ª–∞):**
```json
{
  "hasAccess": false,
  "reason": "–ü–æ–¥–ø–∏—Å–∫–∞ PRO –∏—Å—Ç–µ–∫–ª–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–¥–ª–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É"
}
```

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏:

- `JWT_SECRET` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT —Ç–æ–∫–µ–Ω–æ–≤
- `YC_S3_ENDPOINT` - –∞–¥—Ä–µ—Å Object Storage (–æ–±—ã—á–Ω–æ `https://storage.yandexcloud.net`)
- `YC_ACCESS_KEY_ID` - ID –∫–ª—é—á–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ Object Storage
- `YC_SECRET_ACCESS_KEY` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞ –∫ Object Storage
- `YC_S3_BUCKET_USER` - –∏–º—è –±–∞–∫–µ—Ç–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üíæ –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ JSON —Ñ–∞–π–ª–∞—Ö –≤ Object Storage:

```
s3://sekta-users/users/{email}.json
```

**–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞:**
```json
{
  "email": "user@example.com",
  "name": "–ò–º—è –§–∞–º–∏–ª–∏—è",
  "birthDate": "1990-01-01",
  "gender": "male",
  "registrationDate": "2025-10-11T16:32:33.150Z",
  "tariff_info": {
    "status": "PRO",
    "start": "2025-10-11T16:32:33.150Z",
    "end": "2025-11-11T16:32:33.150Z"
  },
  "passwordHash": "$2a$10$..."
}
```

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–æ–∫

–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏:

```
s3://sekta-users/transactions/{transaction_id}.json
```

**–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞:**
```json
{
  "id": "57bcdcc2-c502-468e-8f39-54120b9e8704",
  "userId": "user@example.com",
  "duration": "1month",
  "description": "–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ PRO –Ω–∞ 1 –º–µ—Å—è—Ü(–µ–≤)",
  "createdAt": "2025-10-11T16:19:12.032Z",
  "paymentId": "yukassa_payment_123"
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
curl -X POST https://d5dvnkk82lmmsbbr7ob1.4b4k4pg5.apigw.yandexcloud.net/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "test123",
    "name": "Test User",
    "birthDate": "1990-01-01",
    "gender": "male"
  }'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ PRO —Ñ—É–Ω–∫—Ü–∏—è–º

```bash
TOKEN="your_jwt_token_here"

curl -X POST https://d5dvnkk82lmmsbbr7ob1.4b4k4pg5.apigw.yandexcloud.net/subscription/check-access \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN"
```

### –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏

```bash
TOKEN="your_jwt_token_here"

curl -X POST https://d5dvnkk82lmmsbbr7ob1.4b4k4pg5.apigw.yandexcloud.net/subscription/activate \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "duration": "1month",
    "paymentId": "test_payment_123"
  }'
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
TOKEN="your_jwt_token_here"

curl https://d5dvnkk82lmmsbbr7ob1.4b4k4pg5.apigw.yandexcloud.net/user/me \
  -H "Authorization: Bearer $TOKEN"
```

## üì± React Native –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```typescript
const API_URL = 'https://d5dvnkk82lmmsbbr7ob1.4b4k4pg5.apigw.yandexcloud.net';

const register = async (
  email: string,
  password: string,
  name: string,
  birthDate: string,
  gender: string
) => {
  const response = await fetch(`${API_URL}/register`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password, name, birthDate, gender }),
  });
  return await response.json();
};

const checkAccess = async (token: string) => {
  const response = await fetch(`${API_URL}/subscription/check-access`, {
    method: 'POST',
    headers: {
      Authorization: `Bearer ${token}`,
      'Content-Type': 'application/json',
    },
  });
  return await response.json();
};

const activateSubscription = async (
  token: string,
  duration: '1month' | '3months' | '1year',
  paymentId?: string
) => {
  const response = await fetch(`${API_URL}/subscription/activate`, {
    method: 'POST',
    headers: {
      Authorization: `Bearer ${token}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ duration, paymentId }),
  });
  return await response.json();
};

const useProFeature = async (token: string, featureFunction: () => Promise<void>) => {
  const accessResult = await checkAccess(token);
  
  if (accessResult.hasAccess) {
    await featureFunction();
    return { success: true };
  } else {
    return {
      success: false,
      reason: accessResult.reason,
    };
  }
};
```

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–æ–∫

### –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
```typescript
tariff_info: {
  status: 'TRIAL',
  trialCount: 4
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ (`/subscription/check-access`):

**–î–ª—è PRO:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –∏—Å—Ç–µ–∫–ª–∞ –ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ (`end > now`)
2. –ï—Å–ª–∏ –∏—Å—Ç–µ–∫–ª–∞ ‚Üí –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –Ω–∞ TRIAL —Å 0 –ø–æ–ø—ã—Ç–æ–∫
3. –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–∞ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `hasAccess: true`

**–î–ª—è TRIAL:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `trialCount > 0`
2. –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–ø—ã—Ç–∫–∏ ‚Üí —É–º–µ–Ω—å—à–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `hasAccess: true`
3. –ï—Å–ª–∏ –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `hasAccess: false` —Å –ø—Ä–∏—á–∏–Ω–æ–π

### –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ (`/subscription/activate`):

```typescript
// –ó–∞–ø—Ä–æ—Å
{
  duration: '1month' | '3months' | '1year',
  paymentId?: string
}

// –†–µ–∑—É–ª—å—Ç–∞—Ç
tariff_info: {
  status: 'PRO',
  start: '2025-10-11T16:32:33.150Z',
  end: '2025-11-11T16:32:33.150Z'  // +1/3/12 –º–µ—Å—è—Ü–µ–≤
}
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **TRIAL —Å—á–µ—Ç—á–∏–∫ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `/subscription/check-access` (–µ—Å–ª–∏ `hasAccess: true`)
2. **–ù–µ –Ω—É–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ —Å–ø–∏—Å—ã–≤–∞—Ç—å –ø–æ–ø—ã—Ç–∫–∏** - –º–µ—Ç–æ–¥ check-access –¥–µ–ª–∞–µ—Ç —ç—Ç–æ —Å–∞–º
3. **–ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ PRO** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –Ω–∞ TRIAL —Å 0 –ø–æ–ø—ã—Ç–æ–∫
4. **–í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π—Ç–µ check-access** –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º PRO —Ñ—É–Ω–∫—Ü–∏–π
5. **–ü–∞—Ä–æ–ª—å —Ç–µ–ø–µ—Ä—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –ª–æ–≥–∏–Ω–µ

## üóÑÔ∏è –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–æ–ª–µ–º `tokens` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:

```typescript
// –ü—Ä–∏–º–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏
if (user.tokens !== undefined) {
  user.tariff_info = {
    status: 'TRIAL',
    trialCount: Math.max(user.tokens, 0)
  };
  delete user.tokens;
}
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–õ–æ–≥–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ [–∫–æ–Ω—Å–æ–ª–∏ Yandex Cloud](https://console.cloud.yandex.ru/):

- API Gateway ‚Üí sekta-api
- Cloud Functions ‚Üí —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API Gateway

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –∏–ª–∏ `gateway.yaml`:

```bash
yc serverless api-gateway update sekta-api --spec gateway.yaml
```

## üìã Checklist –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

- [x] –£–¥–∞–ª–µ–Ω—ã —Ñ–∞–π–ª—ã —Ç–æ–∫–µ–Ω–æ–≤
- [x] –°–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã –ø–æ–¥–ø–∏—Å–æ–∫
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–∏–ø—ã
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
- [x] –û–±–Ω–æ–≤–ª–µ–Ω gateway.yaml
- [x] –ó–∞–¥–µ–ø–ª–æ–µ–Ω—ã –Ω–æ–≤—ã–µ Cloud Functions
- [x] –û–±–Ω–æ–≤–ª–µ–Ω API Gateway
- [ ] –ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω –∫–ª–∏–µ–Ω—Ç (React Native)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT